<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vào thi | Trang Cá Nhân</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        /* Global Styles */
        :root {
            --primary-color: #29ABE2;
            --secondary-color: #4cb5f5;
            --accent-color: #ff5e57;
            --bg-dark: #222;
            --bg-light: #f8f9fa;
            --text-dark: #333;
            --text-light: #fff;
            --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --gradient-bg: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            overflow-x: hidden;
            line-height: 1.6;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }

        a:hover {
            color: var(--secondary-color);
        }

        /* Navbar Styles */
        .navbar {
            background-color: var(--bg-dark);
            box-shadow: var(--box-shadow);
            padding: 1.2rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--text-light);
            transition: color var(--transition-speed) ease;
        }

        .navbar-brand:hover {
            color: var(--primary-color);
        }

         .nav-links {
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-left: auto; /* Push to the right */
        }
         .nav-links a {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            text-decoration: none;
            margin-right: 10px;
            margin-bottom: 5px;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background-color 0.3s;
            text-align: center;
        }
         .nav-links a:hover {
             background-color: rgba(255, 255, 255, 0.1);
        }
        .nav-links i {
            margin-bottom: 5px;
            font-size: 1.5em;
            transition: color 0.3s;
        }
        .nav-links a:hover i {
              color: var(--secondary-color);
        }
        @media (min-width: 768px) {
          .nav-links {
                justify-content: flex-start;
            }
             .nav-links a {
               flex-direction: row;
                margin-right: 20px;
                text-align: left;
               align-items: center;
            }
              .nav-links i{
               margin-right: 5px;
                margin-bottom: 0;
               font-size: 1em;
            }
        }
         .profile-header {
             cursor: pointer;
            position: relative;
            display: inline-flex; /* Use inline-flex */
            align-items: center; /* Vertically center the icon and text */
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 5px;
           transition: background-color 0.3s;
            color: var(--text-light);
        }
          .profile-header i {
             color: var(--secondary-color);
            margin-right: 5px; /* Add some spacing between icon and text */
        }
         .profile-header:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
         .profile-header:hover i {
            color: var(--primary-color);
        }
         .profile-popup {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            padding: 15px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            border-radius: 5px;
        }
        .profile-popup.active {
            display: block;
        }
        .profile-popup ul {
            list-style: none;
            padding: 0;
        }
        .profile-popup li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .profile-popup li:hover {
            background-color: #f8f9fa;
        }
        .profile-popup li:last-child {
            border-bottom: none;
        }
           .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 10px;
            width: 900px;
        }
         .popup.active {
            display: block;
        }
        #info-popup .popup-content p {
            margin-bottom: 10px;
        }
        #info-popup .popup-content {
            padding: 25px;
        }
         .table-responsive {
            overflow-x: auto;
        }
        .table-rounds {
          background-color: var(--text-light);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            font-size: 0.9rem;
            width: 100%;
            margin: 1.5rem auto;
        }
         .table-rounds thead {
           background: var(--gradient-bg);
            color: var(--text-light);
            font-weight: 500;
        }
        .table-rounds th,
        .table-rounds td {
           text-align: center;
            padding: 1rem;
            border: none;
            white-space: nowrap;
            vertical-align: middle;
        }
        .table-rounds tbody tr:nth-child(even) {
            background-color: var(--bg-light);
        }
        .table-rounds tbody tr:hover {
            background-color: #e0f7f5;
        }
        .btn-round {
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .btn-round:hover {
            background-color: darken(var(--primary-color), 10%);
        }
          .btn-not-open{
            background-color: #ccc;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
              font-size: 1rem;
            white-space: nowrap;
        }
        .not-eligible {
           color: black;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 1rem;
            white-space: nowrap;
        }
        .btn-close {
          position: absolute;
            top: 10px;
            right: 10px;
              background-image: url('https://media.istockphoto.com/id/1131230925/vi/vec-to/d%E1%BA%A5u-ki%E1%BB%83m-bi%E1%BB%83u-t%C6%B0%E1%BB%A3ng-ch%E1%BB%AF-th%E1%BA%ADp-%C4%91%E1%BB%8F-%C4%91%C6%A1n-gi%E1%BA%A3n-vector.jpg?s=612x612&w=0&k=20&c=Zl4pvbt2-7JoQCohB1JdIf2JKS-BoHbhQGNhmhwaiSA=');
                background-size: contain;
               width: 24px;
              height: 24px;
             cursor: pointer;
             border: 0;
               background-repeat: no-repeat;
          
        }
          .profile-picture-container {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto;
            margin-bottom: 15px;
        }
        .profile-picture-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
         .profile-picture-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
          .profile-picture-container::before {
            content: "\f030";
            font-family: 'Font Awesome 6 Free';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 2rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
          .profile-picture-container:hover::before {
            opacity: 1;
        }
        .profile-picture-container:hover input[type="file"] {
            cursor: pointer;
        }
            .profile-popup-menu {
            position: relative;
        }
        #edit-profile-btn {
            float: right;
        }
           .form-control:disabled {
            background: #fff;
            cursor: not-allowed;
            opacity: 0.7;
        }
        #rounds-table-container {
            margin-bottom: 200px;
        }
         h1.text-center {
                margin-top: 120px;
                 margin-bottom: 0;
                 color: var(--primary-color);
                font-weight: 600;
        }
          .table-container{
                padding: 20px;
                 background-color: var(--text-light);
                border-radius: var(--border-radius);
               box-shadow: var(--box-shadow);
               margin-top: 2rem;
            }
        .popup .btn-close {
             position: absolute;
            top: 10px;
            right: 10px;
                background-image: url('https://media.istockphoto.com/id/1131230925/vi/vec-to/d%E1%BA%A5u-ki%E1%BB%83m-bi%E1%BB%83u-t%C6%B0%E1%BB%A3ng-ch%E1%BB%AF-th%E1%BA%ADp-%C4%91%E1%BB%8F-%C4%91%C6%A1n-gi%E1%BA%A3n-vector.jpg?s=612x612&w=0&k=20&c=Zl4pvbt2-7JoQCohB1JdIf2JKS-BoHbhQGNhmhwaiSA=');
                background-size: contain;
               width: 24px;
              height: 24px;
             cursor: pointer;
             border: 0;
               background-repeat: no-repeat;
          
        }
          .day-counter {
            font-size: 0.8rem;
            color: gray;
        }
          #current-time {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
            color: var(--secondary-color);
        }
         .table-responsive{
           overflow-x: auto;
        }
/* New Styles For Text Clarity */
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-light);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Stronger shadow for readability */
            letter-spacing: 0.05em; /* Subtle letter spacing for a modern look */
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            color: #e0f7fa; /* Use a brighter, more contrasting color */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4); /* Shadow here as well */
        }

        /* More Modern & Techy Look */
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            /* Dark overlay */
            z-index: 1;
            /* Keep it behind the main text */
        }

        /* Dashboard Styles */
        .dashboard {
            padding: 3rem;
        }

        .dashboard-card {
            background-color: var(--text-light); /* Cards now use a light BG for contrast */
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            color: var(--text-dark); /* And darker text */
            transition: transform var(--transition-speed) ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card h2 {
            font-size: 1.8rem;
            margin-bottom: 1.2rem;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); /* Shadow more subtle on the cards */
        }

        /* Adding some micro-interactions */
        .hero:hover h1,
        .hero:focus h1 {
            transform: scale(1.05);
        }

        /* Information Paragraph Styles */
        .info-paragraph {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            color: var(--text-dark);
        }

        .info-paragraph p {
            margin-bottom: 0.5rem;
        }
                 #notification-popup {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border: 1px solid #ccc;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                z-index: 1002; /* Ensure it's above other popups */
                display: none;
                max-height: 90vh;
                overflow-y: auto;
                border-radius: 10px;
                width: 900px;
        }
            #notification-popup.active {
                display: block;
        }
          #notification-popup .popup-content {
            padding: 20px;
            text-align: center;
        }
        #notification-popup h3 {
             margin-bottom: 15px;
             font-size: 1.7em;
             font-weight: bold;
        }
          #notification-popup .popup-content img {
             max-width: 100%;
             max-height: 400px;
             display: block;
             margin: 15px auto;
         }
          #notification-popup .popup-content p{
            font-size: 1.1em;
        }
         #notification-popup .popup-content .btn-close {
             position: absolute;
             top: 10px;
             right: 10px;
              background-image: url('https://media.istockphoto.com/id/1131230925/vi/vec-to/d%E1%BA%A5u-ki%E1%BB%83m-bi%E1%BB%83u-t%C6%B0%E1%BB%A3ng-ch%E1%BB%AF-th%E1%BA%ADp-%C4%91%E1%BB%8F-%C4%91%C6%A1n-gi%E1%BA%A3n-vector.jpg?s=612x612&w=0&k=20&c=Zl4pvbt2-7JoQCohB1JdIf2JKS-BoHbhQGNhmhwaiSA=');
                background-size: contain;
                width: 24px;
              height: 24px;
             cursor: pointer;
             border: 0;
               background-repeat: no-repeat;
          
        }

        #informationSection {
           display: none;
        }

    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand animate__animated animate__fadeInLeft" href="#">SIO Examination</a>
           <div class="nav-links">
                <a href="vaohoc.html">
                    <i class="fas fa-book" style="color: #3498db;"></i> <span>Vào học</span>
                </a>
                <a href="luyenthi.html">
                    <i class="fas fa-pencil-alt" style="color: #e67e22;"></i> <span>Luyện thi</span>
                </a>
                <a href="dautruong.html">
                    <i class="fas fa-gamepad" style="color: #9b59b6;"></i> <span>Đấu trường</span>
                </a>
                <a href="trangcanhan.html">
                    <i class="fas fa-trophy" style="color: #27ae60;"></i> <span>Vào thi</span>
                </a>
            </div>
            <div class="d-flex align-items-center">
                <div class="profile-header">
                    <i class="fa fa-user-circle me-2"></i> <span id="header-fullname"></span>
                    <div class="profile-popup">
                        <ul class="profile-popup-menu">
                            <li id="info-menu">Thông tin cá nhân</li>
                            <li id="change-password-menu">Đổi mật khẩu</li>
                            <li id="logout-menu">Đăng xuất</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="container dashboard">
        <div class="dashboard-card animate__animated animate__fadeInUp">
            <h2>Danh Sách Vòng Thi <span id="user-grade-display"></span></h2>
           <div id="rounds-table-container">
                <div class="table-container">
                    <div class="table-responsive">
                        <table class="table table-bordered table-rounds">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Tên vòng thi</th>
                                    <th>Ngày mở</th>
                                    <th>Ngày đóng</th>
                                    <th>Điểm</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="rounds-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Popups -->
    <div id="info-popup" class="popup">
        <div class="popup-content">
            <button type="button" class="btn-close" aria-label="Close"></button>
            <h3>Thông tin cá nhân</h3>
            <div class="profile-picture-container">
                <img id="profile-picture" src="https://placehold.co/100x100/333/fff" alt="Ảnh đại diện">
                <input type="file" id="profile-image-upload" accept="image/*">
            </div>
            <button id="edit-profile-btn" class="btn btn-primary">Chỉnh sửa</button>
            <form id="edit-profile-form">
                <div class="mb-3">
                    <label for="popup-fullname" class="form-label">Họ và tên</label>
                    <input type="text" class="form-control" id="popup-fullname" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-username" class="form-label">Tên đăng nhập</label>
                    <input type="text" class="form-control" id="popup-username" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="popup-email" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-phone" class="form-label">Số điện thoại</label>
                    <input type="tel" class="form-control" id="popup-phone" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-address" class="form-label">Địa chỉ</label>
                    <input type="text" class="form-control" id="popup-address" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-grade" class="form-label">Khối</label>
                    <input type="text" class="form-control" id="popup-grade" disabled>
                </div>
                <div class="mb-3">
                    <label for="popup-school" class="form-label">Trường</label>
                    <input type="text" class="form-control" id="popup-school" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-class" class="form-label">Lớp</label>
                    <input type="text" class="form-control" id="popup-class" disabled required>
                </div>
                <div class="mb-3">
                    <label for="popup-dob" class="form-label">Ngày sinh</label>
                    <input type="date" class="form-control" id="popup-dob" disabled required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary" style="display: none">Lưu thông tin</button>
                </div>
            </form>
        </div>
    </div>

    <div id="change-password-popup" class="popup">
        <div class="popup-content">
            <button type="button" class="btn-close" aria-label="Close"></button>
            <h3>Đổi mật khẩu</h3>
            <form id="change-password-form">
                <div class="mb-3">
                    <label for="current-password" class="form-label">Mật khẩu hiện tại</label>
                    <input type="password" class="form-control" id="current-password" required>
                </div>
                <div class="mb-3">
                    <label for="new-password" class="form-label">Mật khẩu mới</label>
                    <input type="password" class="form-control" id="new-password" required>
                </div>
                <div class="mb-3">
                    <label for="confirm-new-password" class="form-label">Nhập lại mật khẩu mới</label>
                    <input type="password" class="form-control" id="confirm-new-password" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Xác nhận đổi mật khẩu</button>
                </div>
            </form>
        </div>
    </div>
     <div id="notification-popup" class="popup">
        <div class="popup-content">
            <button type="button" class="btn-close" aria-label="Close"></button>
            <h3 class="text-center">Thông báo quan trọng</h3>
            <img src="https://blog.xiteb.com/wp-content/uploads/2024/05/360_F_459371368_1C9csykMjOXDUstaTPs6KWpzXMiRuuaT.jpg" alt="Notification Image">
            <p>Chào mừng bạn đến với trang cá nhân của mình! Hãy chắc chắn rằng bạn đã xem qua danh sách các vòng thi và chuẩn bị thật tốt nhé!</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
       const hero = document.querySelector('.hero');
         hero.addEventListener('click', function(){
            document.getElementById('informationSection').style.display = "block";
         });

         const heroTitle = document.querySelector('.hero p');
            heroTitle.addEventListener('click',function(){
             document.getElementById('informationSection').style.display = "block";
           });

    // Your JavaScript remains the same
        const profileHeader = document.querySelector('.profile-header');
        const profilePopup = document.querySelector('.profile-popup');
        const infoPopup = document.getElementById('info-popup');
        const editProfileForm = document.getElementById('edit-profile-form');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const changePasswordPopup = document.getElementById('change-password-popup');
        const changePasswordForm = document.getElementById('change-password-form');
        const profilePicture = document.getElementById('profile-picture');
        const profileImageUpload = document.getElementById('profile-image-upload');
        const roundsTableBody = document.getElementById('rounds-table-body');
        const infoMenu = document.getElementById('info-menu');
        const changePasswordMenu = document.getElementById('change-password-menu');
        const logoutMenu = document.getElementById('logout-menu');
        const userGradeDisplay = document.getElementById('user-grade-display');
        const roundsTableContainer = document.getElementById('rounds-table-container');
        const currentTimeDisplay = document.getElementById('current-time');
        const notificationPopup = document.getElementById('notification-popup');

        const loginTime = localStorage.getItem('loginTime');
        const currentTime = new Date().getTime();
        if (!loginTime || (currentTime - parseInt(loginTime)) > 24 * 60 * 60 * 1000) {
            localStorage.removeItem('user');
            localStorage.removeItem('loginTime');
            window.location.href = 'dangnhap.html';
        }

        // Lấy thông tin người dùng từ localStorage
        const storedUser = localStorage.getItem('user');
        let user;
        if (storedUser) {
            user = JSON.parse(storedUser);
        } else {
            window.location.href = 'dangnhap.html';
        }

        // Hiển thị khối của người dùng
        userGradeDisplay.textContent = user.grade;

        // Hiển thị thông tin người dùng trên header
        document.getElementById('header-fullname').textContent = user.fullname;

        function updateCurrentTime() {
            const now = new Date();
            const formattedTime = now.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            currentTimeDisplay.textContent = formattedTime;
        }
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000);

        function toggleProfilePopup() {
            profilePopup.classList.toggle('active');
            if (profilePopup.classList.contains('active')) {
                document.addEventListener('click', function (event) {
                    if (!profileHeader.contains(event.target)) {
                        profilePopup.classList.remove('active');
                        document.removeEventListener('click', arguments.callee);
                    }
                });
            }
        }
        profileHeader.addEventListener('click', toggleProfilePopup);

        function closeAllPopup() {
            infoPopup.classList.remove('active');
            changePasswordPopup.classList.remove('active');
        }
        document.querySelectorAll('.popup .btn-close').forEach(closeButton => {
            closeButton.addEventListener('click', closeAllPopup);
        });

        function loadInfoPopup() { document.getElementById('popup-fullname').value = user.fullname;
            document.getElementById('popup-username').value = user.username;
            document.getElementById('popup-email').value = user.email;
            document.getElementById('popup-phone').value = user.phone;
            document.getElementById('popup-address').value = `${user.ward}, ${user.district}, ${user.city}`;
            document.getElementById('popup-grade').value = user.grade;
            document.getElementById('popup-school').value = user.school;
            document.getElementById('popup-class').value = user.class;
            document.getElementById('popup-dob').value = user.dob;
            if (user.profilePicture) {
                profilePicture.src = user.profilePicture;
            } else {
                profilePicture.src = "https://placehold.co/100x100/333/fff";
            }
        }
        loadInfoPopup();

        // Xử lý nút đăng xuất
        logoutMenu.addEventListener('click', function () {
            profilePopup.classList.remove('active');
            localStorage.removeItem('user');
            localStorage.removeItem('loginTime');
            window.location.href = 'dangnhap.html';
        });

        // Mở popup thông tin cá nhân
        infoMenu.addEventListener('click', function () {
            profilePopup.classList.remove('active');
            loadInfoPopup();
            infoPopup.classList.add('active');
        });
        // Mở popup đổi mật khẩu
        changePasswordMenu.addEventListener('click', function () {
            profilePopup.classList.remove('active');
            changePasswordPopup.classList.add('active');
        });

        editProfileBtn.addEventListener('click', function () {
            editProfileForm.querySelectorAll('.form-control:not([id="popup-username"]):not([id="popup-grade"])').forEach(input => {
                input.disabled = false;
            });
            editProfileForm.querySelector('button[type="submit"]').style.display = 'block';
        });
        // Xử lý sự kiện chỉnh sửa thông tin
        editProfileForm.addEventListener('submit', function (event) {
            event.preventDefault();
            user.fullname = document.getElementById('popup-fullname').value;
            user.username = document.getElementById('popup-username').value;
            user.email = document.getElementById('popup-email').value;
            user.phone = document.getElementById('popup-phone').value;
            user.city = document.getElementById('popup-address').value.split(', ')[2] || user.city;
            user.district = document.getElementById('popup-address').value.split(', ')[1] || user.district;
            user.ward = document.getElementById('popup-address').value.split(', ')[0] || user.ward;
            user.school = document.getElementById('popup-school').value;
            user.class = document.getElementById('popup-class').value;
            user.dob = document.getElementById('popup-dob').value;
            localStorage.setItem('user', JSON.stringify(user));
            loadInfoPopup();
            document.getElementById('header-fullname').textContent = user.fullname;
            alert('Cập nhật thông tin cá nhân thành công!');
            editProfileForm.querySelectorAll('.form-control:not([id="popup-username"]):not([id="popup-grade"])').forEach(input => {
                input.disabled = true;
            });
            editProfileForm.querySelector('button[type="submit"]').style.display = 'none';
            infoPopup.classList.remove('active');
        });
        profileImageUpload.addEventListener('change', function () {
            const file = profileImageUpload.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    if (isImageSafe(e.target.result)) {
                        profilePicture.src = e.target.result;
                        user.profilePicture = e.target.result;
                        localStorage.setItem('user', JSON.stringify(user));
                        alert("Ảnh đại diện đã được cập nhật.");
                    } else {
                        alert("Ảnh không an toàn! Vui lòng chọn ảnh khác.");
                        profileImageUpload.value = '';
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        function isImageSafe(imageBase64) {
            return true;
        }
        // Xử lý form đổi mật khẩu
        changePasswordForm.addEventListener('submit', function (event) {
            event.preventDefault();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;
            if (user.password !== currentPassword) {
                alert('Mật khẩu hiện tại không chính xác!');
                return;
            }
            if (newPassword !== confirmNewPassword) {
                alert('Mật khẩu mới và xác nhận mật khẩu không khớp.');
                return;
            }
            user.password = newPassword;
            localStorage.setItem('user', JSON.stringify(user));
            alert('Đổi mật khẩu thành công!');
            changePasswordPopup.classList.remove('active');
        });

        const rounds = [
            { id: 1, name: 'Vòng 1 - Tự do 1', startDate: '2025-09-05', endDate: '2026-04-13', examId: '404.html', minScore: 200 },
            { id: 2, name: 'Vòng 2 - Tự do 2', startDate: '2025-10-06', endDate: '2026-04-13', examId: '404.html', minScore: 200 },
            { id: 3, name: 'Vòng 3 - Tự do 3', startDate: '2025-11-10', endDate: '2026-04-13', examId: '404.html', minScore: 200 },
            { id: 4, name: 'Vòng 4 - Tự do 4', startDate: '2025-11-24', endDate: '2026-04-13', examId: '404.html', minScore: 200 },
            { id: 5, name: 'Vòng 5 - Tự do 5', startDate: '2025-12-08', endDate: '2026-04-13', examId: '404.html', minScore: 200 },
            { id: 6, name: 'Vòng 6 - Vòng Sơ Khảo 1', startDate: '2024-12-22', endDate: '2025-12-26', examId: 'test tn.html', minScore: 0 },
            { id: 7, name: 'Vòng 7 - Vòng Sơ Khảo 2', startDate: '2026-01-12', endDate: '2026-01-16', examId: '404.html', minScore: 0 },
            { id: 8, name: 'Vòng 8 - Vòng Bán Kết', startDate: '2026-03-10', endDate: '2026-03-13', examId: '404.html', minScore: 0 },
            { id: 9, name: 'Vòng 9 - Vòng Chung Kết', startDate: '2026-04-01', endDate: '2026-04-03', examId: '404.html', minScore: 0 },
        ];
        function renderRoundsTable() {
            roundsTableBody.innerHTML = '';
            if (rounds.length === 0) {
                roundsTableContainer.innerHTML = '<p class="text-center">Không có dữ liệu. Lỗi 404!</p>';
                return;
            }
            const today = new Date();
            let previousRoundPassed = true;

            for (let i = 0; i < rounds.length; i++) {
                const round = rounds[i];
                const startDate = new Date(round.startDate);
                const endDate = new Date(round.endDate);
                const row = document.createElement('tr');
                const link = round.examId;
                let actionButton = '';
                let daysRemaining = '';
                const storedScore = localStorage.getItem(`score_${link}`);
                const score = storedScore !== null ? parseInt(storedScore) : 0;
                const scoreDisplay = storedScore !== null ? storedScore : 'Chưa thi';
                let isEligible = true;
                if (i > 0 && !previousRoundPassed) {
                    isEligible = false;
                }

                if (startDate > today) {
                    const timeDiff = startDate.getTime() - today.getTime();
                    const days = Math.ceil(timeDiff / (1000 * 3600 * 24));
                    if (days <= 2) {
                        daysRemaining = `<span class="day-counter">Còn ${days} ngày</span>`;
                    }
                    actionButton = '<button class="btn btn-not-open" disabled>Chưa mở</button>';
                }
                else if (endDate < today) {
                    actionButton = '<button class="btn btn-not-open" disabled>Đã đóng</button>';
                }
                else if (!isEligible) {
                    actionButton = `<span class="not-eligible">Chưa đủ điều kiện</span>`;

                }
                else {
                    actionButton = `<a href="${link}" class="btn btn-round">Vào thi</a>`;
                }

                row.innerHTML = `
                         <td>${i + 1}</td>
                         <td>${round.name}</td>
                         <td>${round.startDate}${daysRemaining}</td>
                         <td>${round.endDate}</td>
                         <td>${scoreDisplay}</td>
                        <td>${actionButton}</td>
                     `;
                roundsTableBody.appendChild(row);

                if (i < 5 && score < round.minScore && storedScore != null) {
                    previousRoundPassed = false;
                }
            }
        }

        renderRoundsTable();

        // Notification logic
        function showNotificationPopup() {
            notificationPopup.classList.add('active');
            document.addEventListener('click', function (event) {
                if (!notificationPopup.contains(event.target)) {
                    return;
                }
            });
        }

        function hideNotificationPopup() {
            notificationPopup.classList.remove('active');
        }
        notificationPopup.querySelector('.btn-close').addEventListener('click', hideNotificationPopup);
        function handleNotification() {
            let notificationCount = localStorage.getItem('notificationCount') || 0;
            let lastDismissTime = localStorage.getItem('lastDismissTime') || 0;
            let showAfterTime = localStorage.getItem('showAfterTime') || 0;
            const currentTime = Date.now();

            // Check if it's been more than a day since last login or if user cleared the data
            const loginTime = localStorage.getItem('loginTime');
            if (!loginTime || (currentTime - parseInt(loginTime)) > 24 * 60 * 60 * 1000) {
                notificationCount = 0;
                localStorage.setItem('notificationCount', 0);
                localStorage.removeItem('lastDismissTime');
                localStorage.removeItem('showAfterTime');

            }
            if (notificationCount < 5) {
                if (currentTime - parseInt(showAfterTime) >= 0) {
                    showNotificationPopup();
                    notificationCount++;
                    localStorage.setItem('notificationCount', notificationCount);
                    localStorage.setItem('lastDismissTime', currentTime);
                    const waitTime = 2 * 60 * 60 * 1000 + Math.floor(Math.random() * 4 * 60 * 60 * 1000);
                    localStorage.setItem('showAfterTime', currentTime + waitTime);
                }
            } else if (localStorage.getItem('lastDismissTime') && (currentTime - parseInt(localStorage.getItem('lastDismissTime'))) < 3 * 60 * 60 * 1000) {
                return
            } else if (notificationCount >= 5) {
                localStorage.removeItem('lastDismissTime');
                localStorage.setItem('notificationCount', 0);
                localStorage.removeItem('showAfterTime');
            }

        }
        setTimeout(handleNotification, 2000);

        // Disable text selection
        document.addEventListener('selectstart', function (e) {
            e.preventDefault();
        });

        // Disable right-click
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Disable keyboard shortcuts for copy and paste
        document.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'v' || e.key === 'x' || e.key === 'a')) {
                e.preventDefault();
            }
        });
    </script>
</body>

</html>